# Задание по DNS

Пользователю дается вопрос, ответ на который можно найти в DNS-записях.
Примеры:

- "К какому IP-адресу нужно подключиться, чтобы посмотреть веб-сайт на `https://wikipedia.org`?"
- "Какому адресу нужно передать письмо, адресованное `example@yandex.ru`?"
- "Мы получили письмо, на котором написано, что оно отправлено `example@gmail.com`. Нам передал его сервер по IP-адресу `a.b.c.d`. Согласно SPF, действительно ли это письмо от `gmail.com`?"

## Запуск

Тестировалось на Arch Linux.

Требуется установить Rust и Cargo. Один способ -- `https://rustup.rs`.

После этого, в этой директории, выполнить:

```
cargo run
```

После сборки будет запущен веб-сервер на порте 5000.
Также можно найти файл под названием `dns_live` в папке `target` в корне проекта -- 
это будет статически собранная программа, которую можно запустить независимо.
Единственное требование -- в рабочей директории должна находиться папка `sessions`.

Для каждого пользователя нужно создать *сессию*, которая представлена JSON-файлом в папке `sessions`.
Внутри сессии указан вопрос и ожидаемые ответы на него.
Есть два способа задать ответ: либо как ответ на определенный DNS-запрос (`Derived`, в `example1.json`), который будет отправлен в момент отправки ответа на вопрос;
либо как список допустимых ответов (`Preset`, в `example2.json`) в случае, когда предыдущий вариант недостаточен для описания вопроса
(в таком случае следует часто проверять, что ответ совпадает с настоящим ответом)

## Использование

При переходе на главную страницу пользователю предлагается ввести *ключ сессии* -- название JSON-файла в папке `sessions`.
Если введен существующий ключ сессии, то откроется страница сессии.
На этой странице показана история запросов, которые были выполнены внутри этой сессии.
Здесь можно сделать одну из трёх вещей:

- сделать новый DNS-запрос, указав IPv4-адрес DNS-сервера, тип запроса (`A`, `NS`, `MX`, `CNAME`, `TXT` итд.) и имя, относительно которого выполняется запрос. Прежде чем запрос будет сделан, будет сделано несколько запросов по поводу доменов в разных зонах: если сервер ответит на достаточно много из них, то считается, что сервер рекурсивный, и запрос к такому серверу запрещается);
- изменить формат вывода (`Classic` похож на вывод команды `dig` и конфигурацию зоны в BIND, а `Rust` похож на JSON и показывает внутренний формат структуры данных в программе). Изменение применяется для новых запросов;
- отправить ответ. Этот ответ будет проверен относительно публичного рекурсивного DNS-сервера и помечен как правильный или неправильный. Также будет уменьшен счетчик ответов. Если ответ правильный, или если счетчик ответов равен нулю, то сессия переключается в режим только для чтения.